# 基础配置
d-i debian-installer/locale string zh_CN.UTF-8
d-i debian-installer/language string zh_CN
d-i debian-installer/country string CN
d-i keyboard-configuration/xkb-keymap select cn

# 网络：智能适配网卡（单网卡自动选，多网卡手动选）+ 手动输IP
d-i netcfg/choose_interface select auto
d-i netcfg/choose_interface_manual boolean true
# 手动配置静态IP，无确认弹窗
d-i netcfg/dhcp_options select Configure network manually
d-i netcfg/get_ipaddress string
d-i netcfg/get_netmask string
d-i netcfg/get_gateway string
d-i netcfg/get_nameservers string
d-i netcfg/confirm_static boolean false
d-i netcfg/confirm boolean false
d-i netcfg/get_hostname string debian

# 阿里云源
d-i mirror/country string manual
d-i mirror/protocol string http
d-i mirror/http/hostname string mirrors.aliyun.com
d-i mirror/http/directory string /debian

# 软件包+用户
tasksel tasksel/first multiselect standard, ssh-server
d-i pkgsel/include string openssh-server sudo curl vim htop net-tools lvm2 xfsprogs
d-i passwd/root-login boolean true
d-i passwd/make-user boolean false
d-i passwd/root-password password Nihao0538
d-i passwd/root-password-again password Nihao0538
d-i clock-setup/utc boolean true
d-i time/zone string Asia/Shanghai

# ===================== 核心：兼容单盘/多盘，手动选硬盘（多盘）/自动选盘（单盘） =====================
d-i partman-auto/method string lvm
d-i partman/choose_partition select 'guided use entire disk and set up LVM'
# 自动清理硬盘上已有的LVM分区
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-lvm/device_remove_lvm_confirm boolean true
# 单盘自动选盘，多盘手动选盘
d-i partman/auto/disk string /dev/sda
d-i partman/choose_disk select default

d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true
d-i partman-lvm/confirm boolean true
d-i partman-lvm/confirm_nooverwrite boolean true
# 分区格式（GPT+XFS，自动配置）
d-i partman-partitioning/choose_label string gpt
d-i partman/default_filesystem string xfs

# ===================== 兼容单盘/多盘：GRUB自动适配引导硬盘 =====================
d-i grub-installer/bootdev string default
d-i grub-installer/force boolean true
d-i grub-installer/only_debian boolean true
d-i grub-installer/confirm boolean true
d-i grub-installer/skip boolean false
d-i partman-basicfilesystems/no_bootable_partition boolean true
# 强化GRUB兼容性
d-i grub-installer/grub2_instead_of_grub boolean true
d-i grub-installer/try_usb_first boolean false

# 自动重启
d-i finish-install/reboot boolean true
d-i finish-install/reboot_in_progress note


# SSH配置：允许root远程登录+密码登录
d-i preseed/late_command string \
  in-target sed -i '/^#*PermitRootLogin/c\PermitRootLogin yes' /etc/ssh/sshd_config; \
  in-target sed -i '/^#*PasswordAuthentication/c\PasswordAuthentication yes' /etc/ssh/sshd_config; \
  in-target systemctl restart sshd 